---
- name: Download latest anaconda installer
  sudo: False
  get_url: url=https://repo.continuum.io/archive/Anaconda3-4.0.0-Linux-x86_64.sh
           dest=/tmp/anaconda.sh

- name: Install anaconda (default folder)
  sudo: false
  shell: bash /tmp/anaconda.sh -b

- name: Add anaconda to the PATH
  lineinfile: dest= ~/.bashrc line="export PATH=~/anaconda/bin:$PATH"
  become: no

- name: Restart server
  shell: sleep 2 && /sbin/shutdown -r now
  async: 1
  poll: 0
  ignore_errors: true

- name: Wait for server to restart
  local_action:
    module: wait_for host={{ inventory_hostname }} delay=30 timeout=120 state=started
  become: false

- name: Update conda to latest version
  command: ~/anaconda/bin/conda update conda --yes -q
  become: no